---
title: "Pre-processing"
output: html_document
date: "2025-06-24"
---

Libraries required
```{r setup, include=FALSE}
library(SeuratObject)
library(sp)
library(Seurat)
library(hdf5r)
library(dplyr)
library(patchwork)
#library(tidyverse)
```

Download the data
```{r}
CLL_p1_D1_filtered.data <- Read10X_h5("~/Documents/Singlecell-R/P1/run_count_J1/outs/filtered_feature_bc_matrix.h5")
CLL_p1_D4_filtered.data <- Read10X_h5("~/Documents/Singlecell-R/P1/run_count_J4/outs/filtered_feature_bc_matrix.h5")
CLL_p1_D8_filtered.data <- Read10X_h5("~/Documents/Singlecell-R/P1/run_count_J8/outs/filtered_feature_bc_matrix.h5")
CLL_p1_D11_filtered.data <- Read10X_h5("~/Documents/Singlecell-R/P1/run_count_J11/outs/filtered_feature_bc_matrix.h5")
CLL_p1_D14_filtered.data <- Read10X_h5("~/Documents/Singlecell-R/P1/run_count_J14/outs/filtered_feature_bc_matrix.h5")

CLL_p1_D1_filtered <- CreateSeuratObject(counts = CLL_p1_D1_filtered.data, project = "P1_D1_filtered")
CLL_p1_D4_filtered <- CreateSeuratObject(counts = CLL_p1_D4_filtered.data, project = "P1_D4_filtered")
CLL_p1_D8_filtered <- CreateSeuratObject(counts = CLL_p1_D8_filtered.data, project = "P1_D8_filtered")
CLL_p1_D11_filtered <- CreateSeuratObject(counts = CLL_p1_D11_filtered.data, project = "P1_D11_filtered")
CLL_p1_D14_filtered <- CreateSeuratObject(counts = CLL_p1_D14_filtered.data, project = "P1_D14_filtered")
```
Add an identity with the time point
```{r}
CLL_p1_D1_filtered$timepoint <- "D1"
CLL_p1_D4_filtered$timepoint <- "D4"
CLL_p1_D8_filtered$timepoint <- "D8"
CLL_p1_D11_filtered$timepoint <- "D11"
CLL_p1_D14_filtered$timepoint <- "D14"
```
Merge all the data filtered, in order to have one SeuratObject with all the time point for one patient
```{r}
CLL_p1_merged <- merge(CLL_p1_D1_filtered, y = list(CLL_p1_D4_filtered, CLL_p1_D8_filtered, CLL_p1_D11_filtered, CLL_p1_D14_filtered), add.cell.ids = c("D1", "D4", "D8", "D11", "D14"), merge.data =TRUE, project = "TimeCourse")
```

## Pre-processing

# QC and filtering 
This step in done on the data days merged (same threshold for the 5 time points).

Damaged cells elimination (mitochondrial gene percentage vs nuclear function)
```{r}
CLL_p1_merged[["percent.mt"]] <- PercentageFeatureSet(CLL_p1_merged, pattern = "^MT-")
```
Observe the distribution on violon plot, in order to adapt the threshold 
```{r}
VlnPlot(CLL_p1_merged, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
VlnPlot(CLL_p1_merged, features = c("percent.mt"))
```


# Doublet elimination

1- Finding the optimal arguments, PCs, pK, and nExp, (keep pN=0,25)  for the function DoubletFinder
```{r cars}

```

# Non coding genes elimination


