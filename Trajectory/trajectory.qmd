---
title: "Trajectory"
params: 
  patient: "P1"
  file: "CLL_P1_seurat_reduit.rds"
  type: "Seurat"
format: html
editor: visual
---

## Trajectory analysis

The analyzed dataset consists of five timepoints. The goal of trajectory analysis in single-cell data is to reconstruct the dynamic processes that cells undergo, such as differentiation or activation. In our study, we aim to determine whether specific clusters or transitional states, particularly the bridge between B cells and macrophages, emerge or evolve over the 14-day time course. This approach allows us to capture temporal changes in cell states.

```{r}
#| message: false
library(SeuratObject)
library(sp)
library(Seurat)
library(hdf5r)
library(dplyr)
library(patchwork)
library(ggplot2)
library(SeuratData)
library(pheatmap)
library(viridis)
library(stringr)
source("functions.R")
```

```{r}
data<-readRDS(params$file)
```

Change the day color?

Sur les data annotÃ©es

```{r}
data$timepoint <- factor(
  data$timepoint,
  levels = c("D1", "D4", "D8", "D11", "D14")
)
title=paste("Trajectory UMAP, pre-processing type :", params$type, ", patient", params$patient)
plotumap<-DimPlot(data, group.by = "timepoint", reduction = "umap", pt.size=0.1, label.size = 2.5) + ggtitle(str_wrap(title, width = 100)) + theme(plot.title = element_text(size = 15, hjust = 0.5), width = 3000, height = 2000, units = "px")
plotumap
ggsave(paste0(params$type,"_trajectory_umap_", params$patient, ".jpeg"), plotumap)
```

UMAP by timepoint

```{r}
data$timepoint <- factor(
  data$timepoint,
  levels = c("D1", "D4", "D8", "D11", "D14")
)
title=paste("UMAP by timepoint, pre-processing type :", params$type, ", patient", params$patient)
plotumap<-DimPlot(data, reduction = "umap", group.by = "seurat_clusters", split.by = "timepoint") + ggtitle(str_wrap(title, width = 100)) + theme(plot.title = element_text(size = 15, hjust = 0.5)) + NoLegend()
plotumap
ggsave(paste0(params$type,"_timepoint_umap_", params$patient, ".jpeg"), plotumap, width = 5000,
  height = 2000, units = "px")
```

Focus on B cell

Focus on the T cell

Focus on the bridge?
